local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Vytvoření ScreenGui a Frame pro UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BlackdotMenu"
ScreenGui.Parent = LocalPlayer.PlayerGui

local Frame = Instance.new("Frame")
Frame.Name = "MenuFrame"
Frame.Size = UDim2.new(0, 300, 0, 200)
Frame.Position = UDim2.new(0.5, -150, 0.5, -100)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.BackgroundTransparency = 0.9
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, 0, 0, 50)
TitleLabel.Position = UDim2.new(0, 0, 0, 0)
TitleLabel.Text = "Blackdot - Bladeball"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextScaled = true
TitleLabel.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
TitleLabel.BorderSizePixel = 0
TitleLabel.Parent = Frame

-- Vytvoření checkboxů
local function createCheckbox(name, text, position)
    local checkbox = Instance.new("TextButton")
    checkbox.Name = name
    checkbox.Size = UDim2.new(1, 0, 0, 50)
    checkbox.Position = position
    checkbox.Text = text
    checkbox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    checkbox.TextColor3 = Color3.fromRGB(255, 255, 255)
    checkbox.TextScaled = true
    checkbox.BorderSizePixel = 1
    checkbox.BorderColor3 = Color3.fromRGB(255, 255, 255)
    checkbox.Parent = Frame
    return checkbox
end

local BlockCheckbox = createCheckbox("BlockCheckbox", "Enable Block", UDim2.new(0, 0, 0.2, 0))
local BallDetectionCheckbox = createCheckbox("BallDetectionCheckbox", "Enable Ball Detection", UDim2.new(0, 0, 0.4, 0))
local VisualIndicatorCheckbox = createCheckbox("VisualIndicatorCheckbox", "Enable Visual Indicator", UDim2.new(0, 0, 0.6, 0))

-- Přetahování GUI
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

RunService.RenderStepped:Connect(function()
    if dragging and dragInput then
        update(dragInput)
    end
end)

-- Funkce pro kliknutí na checkbox
local function toggleCheckbox(button)
    if button.BackgroundColor3 == Color3.fromRGB(70, 70, 70) then
        button.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        -- Aktivace funkce
        if button.Name == "BlockCheckbox" then
            -- Zapnout funkci BLOCK
        elseif button.Name == "BallDetectionCheckbox" then
            -- Zapnout detekci míče
        elseif button.Name == "VisualIndicatorCheckbox" then
            -- Zapnout vizuální indikátor
        end
    else
        button.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
        -- Deaktivace funkce
        if button.Name == "BlockCheckbox" then
            -- Vypnout funkci BLOCK
        elseif button.Name == "BallDetectionCheckbox" then
            -- Vypnout detekci míče
        elseif button.Name == "VisualIndicatorCheckbox" then
            -- Vypnout vizuální indikátor
        end
    end
end

-- Při kliknutí na checkbox
BlockCheckbox.MouseButton1Click:Connect(function()
    toggleCheckbox(BlockCheckbox)
end)

BallDetectionCheckbox.MouseButton1Click:Connect(function()
    toggleCheckbox(BallDetectionCheckbox)
end)

VisualIndicatorCheckbox.MouseButton1Click:Connect(function()
    toggleCheckbox(VisualIndicatorCheckbox)
end)

-- Vytvoření a nastavení vizuálního indikátoru
local function createVisualIndicator()
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end

    local visualIndicator = Instance.new("Part")
    visualIndicator.Name = "VisualIndicator"
    visualIndicator.Size = Vector3.new(1, 1, 1) -- Malá velikost, upravíme velikost podle potřeby
    visualIndicator.Anchored = true
    visualIndicator.CanCollide = false
    visualIndicator.BrickColor = BrickColor.new("Bright red")
    visualIndicator.Transparency = 0.5
    visualIndicator.Parent = Workspace
    visualIndicator.CFrame = character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -5) -- Startovní pozice

    return visualIndicator
end

local visualIndicator = createVisualIndicator()

-- Funkce pro aktualizaci velikosti a pozice vizuálního indikátoru
local function updateVisualIndicator(radius)
    if not visualIndicator then return end
    visualIndicator.Size = Vector3.new(radius * 2, 1, radius * 2)
    visualIndicator.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -radius)
end

-- Funkce pro detekci a blokování míče
local function findAndHandleRedBall()
    local maxDistance = 10 -- Startovní hodnota dosahu, měníme podle rychlosti míče
    for _, object in pairs(Workspace:GetChildren()) do
        if isRedBall(object) and isBallNear(object, maxDistance) then
            -- Při detekci míče upravíme dosah podle rychlosti míče
            local ballSpeed = getBallSpeed(object)
            local newRadius = math.min(ballSpeed / 10, 20) -- Přizpůsobíme maximální dosah
            updateVisualIndicator(newRadius)
            -- Klikni na tlačítko BLOCK
            clickBlockButton()
            break -- Pokud je míč zpracován, není třeba pokračovat ve hledání
        end
    end
end

-- Hlavní smyčka pro kontrolu míče a klikání
RunService.RenderStepped:Connect(function()
    if VisualIndicatorCheckbox.BackgroundColor3 == Color3.fromRGB(0, 255, 0) then
        findAndHandleRedBall()
    end
end)

-- Funkce pro automatické kliknutí na tlačítko BLOCK
local function clickBlockButton()
    local blockButton = LocalPlayer.PlayerGui:FindFirstChild("BlockButton")
    if blockButton and blockButton:IsA("GuiButton") then
        blockButton.MouseButton1Click:Fire() -- Simulace kliknutí na tlačítko
    end
end
